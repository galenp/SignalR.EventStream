function EventStream(a) { this.authorizeFor = a; this.initialized = false; this.connect = function () { if (!this.initialized) { var a = $.connection.eventStream; var b = this; a.receiveEvent = function (a) { var c = $.parseJSON(a); b.eventReceived(c.Type, c.Event) }; $.connection.hub.start({}, function () { a.authorize(b.authorizeFor).fail(function (a) { $.connection.hub.stop(); b.connectionFailed(a) }).done(function (a) { if (a !== true) { $.connection.hub.stop(); b.unauthorized() } }) }); this.initialized = true } return this }; this.eventReceived = function (a, b) { }; this.connectionFailed = function (a) { alert("unable to connect to event stream.\r\nError:" + a) }; this.unauthorized = function (a) { } } function PageStream() { return new EventStream(window.location.pathname) }